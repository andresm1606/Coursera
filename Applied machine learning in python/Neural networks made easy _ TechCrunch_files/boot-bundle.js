(window.webpackJsonp_spotim_580132258=window.webpackJsonp_spotim_580132258||[]).push([[27],{12:function(e,t,n){"use strict";var o=n(34),i=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.boot=A;var r=i(n(37)),s=i(n(38)),a=n(3),c=o(n(20)),l=n(255),d=i(n(258)),u=n(259),p=n(487),f=i(n(695)),m=i(n(58)),_=n(697),v=n(356),O=n(44),g=n(77),y=n(358),T=n(170),I=n(359),b=n(707),S=n(276),h=n(222),C=n(708),E=n(118),R=n(64),w=n(365),k=n(171),P=function(){var e=(0,s.default)(r.default.mark((function e(t){var o,i,s,a,c,l;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=t.element,i=t.spotId,s=t.postId,a=t.isLiveBlog,c=t.force,l=t.instanceId,Promise.all([n.e(0),n.e(5),n.e(1),n.e(8),n.e(9),n.e(58)]).then(n.t.bind(null,1054,7)).then((function(e){e.renderRetryConv(o,(function(e){A({element:e,spotId:i,postId:s,isLiveBlog:a,force:c,instanceId:l})}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(e){var t=e.element,n=e.spotId,o=e.postId,i=e.isLiveBlog,r=e.instanceId,s=e.store,c=e.force;(0,v.initI18next)().then((function(){s.dispatch((0,T.setTranslationInitialized)({isTranslationInitialize:!0}))})).catch((function(e){a.metrics.error("loadTranslations",e),P({element:t,spotId:n,postId:o,isLiveBlog:i,force:c,instanceId:r})}))},M=function(e){var t=e.element,n=e.postId,o=e.isLiveBlog,i=e.contentType,r=e.store,s=e.user,d=r.getState(),u=d.appState.isUserInitialized,p=d.currentUser,m=d.moduleOptions.isConversationPage,_=d.isReadOnly;r.dispatch((0,f.default)({currentUser:s})),(0,c.isSameUser)(p,s)||function(e){var t,n=e.element,o=e.postId,i=e.isLiveBlog,r=e.contentType,s=e.dispatch,c=e.isConversationPage,d=e.isReadOnly,u="true"===n.getAttribute(O.PREVIEW_ATTR),p=new Promise((function(e){t=setTimeout((function(){e(!1)}),O.CONVERSATION_LOAD_TIMEOUT)}));Promise.race([p,(0,l.getConversationData)({postId:o,element:n,isPreview:u,isLiveBlog:i})]).then((function(e){if(!e||!e.data)return a.metrics.error("conversation failed to load",new Error("read failed")),void s((0,T.setConversationStatus)({conversationStatus:R.ConversationStatus.ERROR}));clearTimeout(t);var n=e.data;s((0,I.initConversation)({data:n,postId:o,contentType:r})),s((0,k.setReadOnly)({isReadOnly:!(!d&&!n.read_only)})),(0,w.isBackToCommentsWithoutConversationPage)(c)&&s((0,E.setCommunityView)(R.CommunityViewTabTypes.Conversation,!1))})).catch((function(e){a.metrics.error("loadConversation",e),s((0,T.setConversationStatus)({conversationStatus:R.ConversationStatus.ERROR}))}))}({element:t,postId:n,isLiveBlog:o,contentType:i,dispatch:r.dispatch,isConversationPage:m,isReadOnly:_}),u||r.dispatch((0,T.setUserInitialized)({isUserInitialized:!0})),s.unseenNotificationsCount&&r.dispatch((0,y.setUnseenNotificationsCount)(s.unseenNotificationsCount))};function A(e){return N.apply(this,arguments)}function N(){return(N=(0,s.default)(r.default.mark((function e(t){var o,i,s,a,l,f,v,y,I,E,w,k,P,A,N,U;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.element,l=t.spotId,f=t.postId,v=t.isLiveBlog,y=t.force,I=t.instanceId,a){e.next=3;break}return e.abrupt("return");case 3:if(!("false"===a.getAttribute(O.AUTORUN_ATTR))||y){e.next=6;break}return e.abrupt("return");case 6:if(f){e.next=8;break}return e.abrupt("return");case 8:if(null===(o=window)||void 0===o||null===(i=o.__OPEN_WEB__)||void 0===i||null===(s=i.initCurrentUser)||void 0===s||s.call(i,{spotId:l,postId:f}),(0,_.handleScrollToComments)(),E=a.getAttribute("data-post-page-post-id"),w=a.getAttribute("data-content-type")||R.ContentType.Conversation,O.isModerationV2CrossProjectFlagEnabled||E&&(w=R.ContentType.Post),(0,g.setIsConsumedUrlParams)(!0),k=a.dataset.spotImScrollToComment,P=a.dataset.spotImScrollToReply,A="true"===a.dataset.autoFocus,N=(0,p.initializeStore)(f,{isConversationLiveBlog:v,isConversationPage:"true"===a.getAttribute("data-spotim-conversation-page"),contentType:w,instanceId:I,backToCommentsOverride:{commentId:k,replyId:P,useOverride:!!k||!!P||A,disableMessageSayCtrlFocusOnMount:!A,forceFocusMainSayCtrl:A&&!k&&!P},isConsumedUrlParams:!!a.dataset.isConsumedUrlParams,elementId:(0,h.getElementId)(a),isReadOnly:"true"===a.getAttribute("data-read-only")}),L({element:a,spotId:l,postId:f,isLiveBlog:v,force:y,instanceId:I,store:N}),c.default.subscribe((function(e){M({user:e,element:a,postId:f,isLiveBlog:v,contentType:w,store:N})})),c.default.subscribeToToken((function(e){N.getState().appState.isTokenInitialized||N.dispatch((0,T.setTokenInitialized)({isTokenInitialized:!0})),N.dispatch((0,S.fetchAuthenticationEnd)(e.networkId,e.token))})),!v){e.next=26;break}return e.next=24,(0,m.default)("v1.0.0/config/liveblog/".concat(l,"/").concat(f),{method:"GET",postId:f,data:{}});case 24:(U=e.sent)&&N.dispatch((0,u.initLiveBlog)(U.event));case 26:Promise.all([n.e(0),n.e(3),n.e(4),n.e(5),n.e(10),n.e(11),n.e(15),n.e(16),n.e(83),n.e(2),n.e(1),n.e(6),n.e(7),n.e(8),n.e(9),n.e(13),n.e(14),n.e(12),n.e(19),n.e(57)]).then(n.t.bind(null,30,7)).then((function(e){e.preRender(a,{store:N,postId:f,isLiveBlog:v,contentType:w,isConversationPage:"true"===a.getAttribute("data-spotim-conversation-page")})})),(0,C.handleEmailReturn)([],N),(0,d.default)(),(0,b.checkSSO)(N.getState());case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},487:function(e,t,n){"use strict";var o=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.initializeStore=function(e,t){var n="".concat(_.spotId,"_").concat(e),o=s.default.get("elementOptions",{}),i=(o.postId,(0,r.default)(o,["postId"])),O=s.default.get("queryParams"),I=t.isConsumedUrlParams?{}:T(g({},O));t.backToCommentsOverride.useOverride&&(I=g(g({},I),T({spot_im_comment_id:t.backToCommentsOverride.commentId,spot_im_reply_id:t.backToCommentsOverride.replyId,spot_im_force_sayctrl_focus:t.backToCommentsOverride.forceFocusMainSayCtrl,spot_im_expand_reply:t.backToCommentsOverride.disableMessageSayCtrlFocusOnMount&&(t.backToCommentsOverride.commentId||t.backToCommentsOverride.replyId),spot_im_scroll_to_comments:!0,spot_im_highlight_immediate:!0})));var b=(0,a.initializeStore)();return b.dispatch((0,c.initializeModuleOptions)({moduleOptions:g(g(g({},(0,u.getModuleOptions)({moduleOptions:g(g(g(g({},y),{},{initialModuleOptions:(0,p.parseSpotConfig)(s.default.get("init_data.config")),conversationId:n,spotId:_.spotId,postId:e},I),{},{eventCode:s.default.get("elementOptions.liveEventCode"),isRecommendedPost:s.default.get("elementOptions.recommendablePost",!0),conversationArticleTags:s.default.get("elementOptions.articleTags")},t),{},{isSafeFrame:(0,d.default)()})})),i),{},{isStarsRatingEnabled:s.default.get("elementOptions.socialReviews"),communityQuestion:s.default.get("elementOptions.communityQuestion")||""})})),b.dispatch((0,v.setReadOnly)({isReadOnly:t.isReadOnly})),b.dispatch((0,m.setPlatform)((0,l.isMobile)()?f.PLATFORMS.MOBILE:f.PLATFORMS.DESKTOP)),b};var i=o(n(33)),r=o(n(66)),s=o(n(1)),a=n(263),c=n(675),l=n(52),d=o(n(256)),u=n(350),p=n(684),f=n(191),m=n(190),_=n(44),v=n(171);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y={spotId:void 0,hostOptions:void 0,urlOptions:void 0,predefinedOptions:void 0,deprecatedOptions:void 0,initialModuleOptions:void 0,elementsOptions:[]};function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={spot_im_comment_id:"highlightedCommentId",spot_im_reply_id:"highlightedReplyId",spot_im_highlight_immediate:"highlightImmediate",spot_im_scroll_to_comments:"scrollToComments",spot_im_expand_reply:"isSayControlExpanded",spot_im_max_messages_depth:"repliesMaxDepth","read-only-implementation":"readOnlyImplementation",spot_im_force_sayctrl_focus:"focusMainSayCtrlOnMount"};return Object.keys(t).reduce((function(n,o){var i=e[o];if(i){var r=t[o];switch(i){case"true":i=!0;break;case"false":i=!1}n[r]=i}return n}),{})}},675:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeConversation=function(e){return function(t){var n;(null===(n=e.moduleOptions)||void 0===n?void 0:n.isSterileConversation)?t({type:o.CLEAR_CONVERSATION}):t({type:o.INITIALIZE_CONVERSATION,payload:e}),t((0,i.initializeTyping)(e.conversation.id)),t((0,r.updateReportedComments)(e.reportedComments))}},t.initializeModuleOptions=function(e){return function(t){t({type:o.INITIALIZE_MODULE_OPTIONS,payload:e})}};var o=n(39),i=n(112),r=n(159)},684:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidHexColor=m,t.completeSpotConfigParse=_,t.parseSpotConfig=function(e){return _(e=(0,o.parseSpotConfig)(e))};var o=n(685),i=n(687),r=n(688),s=n(689),a=n(690),c=n(691),l=n(351),d=n(692),u=n(693),p=n(694),f=n(262);function m(e){return/^#([0-9a-f]{6}|[0-9a-f]{3})$/i.test(e)}function _(e){if(e.brandColor=m(e.brandColor)?e.brandColor:void 0,e.newsfeedPosition=(0,r.parse)(e.newsfeedPosition),e.tickerSkin=(0,i.parse)(e.tickerSkin),e.openMode=(0,s.parse)(e.openMode),e.conversationSort=(0,a.parse)(e.conversationSort),e.conversationSkin=(0,c.parse)(e.conversationSkin),e.registrationSkin=(0,c.parse)(e.registrationSkin),e.connectTypes=(0,d.parseArray)(e.connectTypes),e.isConnectEnabled=!(!(e.connectTypes.length>0)||1===e.connectTypes.length&&e.connectTypes[0]===d.DISQUS),e.useDisqusLogin=e.connectTypes.length>0&&e.connectTypes.indexOf(d.DISQUS)>-1,e.direction=u.RTL_LANGUAGES.indexOf(e.mainLanguage)>-1?u.RTL:u.LTR,e.hostOptionsBlock){var t=(0,p.parseSpotOptions)(e.hostOptionsBlock);(0,f.deepExtendObject)(e,t)}return Object.keys(e).forEach((function(t){void 0===e[t]&&delete e[t]})),(0,l.filterValidOptions)(e)}},685:function(e,t,n){"use strict";var o=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.parseSpotConfig=void 0;var i=o(n(686));t.parseSpotConfig=function(e){return{spotId:e.id,spotName:e.name,networkId:e.network?e.network.id:void 0,tickerIcon:e.ticker_icon,tickerIconSize:e.ticker_icon_size,brandColor:e.brand_color,buttonEnabled:e.button_enabled,categoryId:e.category_id,subCategoryId:e.sub_category_id,languages:e.languages,mainLanguage:e.main_language,newsfeedSkin:e.newsfeed_skin,newsfeedPosition:e.newsfeed_position,tickerSkin:e.ticker_skin,openMode:e.opening_mode,conversationSort:e.sort_by,conversationSkin:e.inpage_skin,registrationSkin:e.inpage_skin,platform:e.platform,websiteUrl:e.website_url,enableSSO:e.sso_enabled,editableSSO:e.sso_editable_profile,hasCommunity:e.has_community,enableConversationHeaderFacesList:(0,i.default)(e.enable_avatars_bar),numberedAvatars:!(!e.avatars||!e.avatars.numbered)&&e.avatars.numbered,displayNameInSayControlForGuests:!!e.display_name_in_say_control_for_guests&&e.display_name_in_say_control_for_guests,connectTypes:e.connect_networks,conversationRecommendationsRowsCount:e.circulation&&e.circulation.rows_count?e.circulation.rows_count:1,popularItemsCount:e.newsfeed_items_count||0,enableMiniNewsfeed:"mini_newsfeed_enabled"in e?e.mini_newsfeed_enabled:void 0,enableNewsfeed:"newsfeed_enabled"in e?e.newsfeed_enabled:void 0,enableRecommendation:e.circulation&&"enabled"in e.circulation?e.circulation.enabled:void 0,forceRegister:e.policy&&"force_register"in e.policy?e.policy.force_register:void 0,enableBlindfold:e.policy&&"roger_mode"in e.policy?e.policy.roger_mode:void 0,enableGuestVoting:e.policy&&"allow_guests_to_like"in e.policy?e.policy.allow_guests_to_like:void 0,enableRealtimeCommentsSticky:(0,i.default)(e.enable_realtime_comments_sticky),enableDownVotesCount:e.enable_dislikes,enableUserPoints:e.enable_user_points,whitelistUrls:e.whitelisted_urls,hostOptionsBlock:e.injection&&"host_options"in e.injection&&e.injection.host_options?e.injection.host_options:void 0,scriptBlock:e.injection&&"frame_script"in e.injection&&e.injection.frame_script?e.injection.frame_script:void 0,styleBlock:e.injection&&"frame_style"in e.injection&&e.injection.frame_style?e.injection.frame_style:void 0,enableSpotimUtm:e.enable_spotim_utm,openLinksInNewTab:e.open_links_in_new_tab,useExternalUserId:e.external_public_profile,conversationRichToolbarEnabled:(0,i.default)(e.rich_say_control_enabled),repliesMaxDepth:e.comment_replies_max_depth,animationRating:("PG_13"===e.giphy_level?"PG-13":e.giphy_level||"none").toLowerCase()}}},686:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&void 0}},687:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){switch(e.toUpperCase()){case"BRAND":case"WHITE":return"BRAND";default:return}},t.WHITE=t.BRAND=void 0;t.BRAND="BRAND";t.WHITE="WHITE"},688:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){switch(e.toUpperCase()){case"LEFT":return"LEFT";case"RIGHT":return"RIGHT";default:return}},t.RIGHT=t.LEFT=void 0;t.LEFT="LEFT";t.RIGHT="RIGHT"},689:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){switch(e.toUpperCase()){case"AUTOMATIC":return"AUTOMATIC";case"PERMANENT":return"PERMANENT";case"ON_CLICK":return"ON_CLICK";default:return}},t.ON_CLICK=t.PERMANENT=t.AUTOMATIC=void 0;t.AUTOMATIC="AUTOMATIC";t.PERMANENT="PERMANENT";t.ON_CLICK="ON_CLICK"},690:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){switch(e.toUpperCase()){case"BEST":return"best";case"NEWEST":return"newest";case"OLDEST":return"oldest";default:return}},t.OLDEST=t.NEWEST=t.BEST=void 0;t.BEST="best";t.NEWEST="newest";t.OLDEST="oldest"},691:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){switch(e.toUpperCase()){case"DARK":return"dark";case"LIGHT":return"light";default:return}},t.LIGHT=t.DARK=void 0;t.DARK="dark";t.LIGHT="light"},692:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=o,t.parseArray=function(e){return Array.isArray(e)?e.map(o).filter((function(e){return void 0!==e})):[]},t.MICROSOFT=t.VK=t.LINKEDIN=t.GOOGLE=t.DISQUS=t.EMAIL=t.TWITTER=t.FACEBOOK=void 0;t.FACEBOOK="facebook";t.TWITTER="twitter";t.EMAIL="email";t.DISQUS="disqus";t.GOOGLE="google";t.LINKEDIN="linkedin";t.VK="vk";function o(e){switch(e.toUpperCase()){case"FACEBOOK":return"facebook";case"TWITTER":return"twitter";case"EMAIL":return"email";case"DISQUS":return"disqus";case"GOOGLE":return"google";case"MICROSOFT":return"microsoft";case"LINKEDIN":return"linkedin";case"VK":return"vk";default:return}}t.MICROSOFT="microsoft"},693:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){switch(e.toUpperCase()){case"RTL":return"rtl";case"LTR":return"ltr";default:return}},t.RTL_LANGUAGES=t.LTR=t.RTL=void 0;t.RTL="rtl";t.LTR="ltr";t.RTL_LANGUAGES=["he","ar","fa"]},694:function(module,exports,__webpack_require__){"use strict";function parseSpotOptions(code){var hostOptions={};if(code)try{!function(c){try{var SPOTIM_OPTIONS={};eval(c),hostOptions=Object.assign(hostOptions,SPOTIM_OPTIONS)}catch(e){console.error("Failed to parse host options")}}(code)}catch(e){console.error("Failed to parse host options")}return hostOptions}Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseSpotOptions=parseSpotOptions},695:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(19),i=n(39),r=n(696),s=n(77),a=n(20),c=(0,o.createAction)(i.SET_CURRENT_USER,(function(e){var t=(0,s.clone)(e);if(!e.currentUser.isRegistered){var n=(0,a.getDisplayName)(e.currentUser);t.currentUser.displayName=n}return t.currentUser.isRegistered&&!t.currentUser.email&&(t.currentUser.email=(0,r.getEmailFromLocalStorage)()),t}));t.default=c},696:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEmailFromLocalStorage=function(){var e,t=localStorage.getItem("spotim_signup.email")||localStorage.getItem("spotim_signin.email");t&&(t=JSON.parse(t),e=t.data.value);return e}},697:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleScrollToComments=function(){var e=window.location.href;if((0,i.objectFromQueryString)(e).spot_im_scroll_to_comments){var t,n,r=(0,o.findConversations)();r&&r.length&&window.scrollTo({top:null===(t=r[0])||void 0===t||null===(n=t.getBoundingClientRect())||void 0===n?void 0:n.top,behavior:"smooth"})}};var o=n(698),i=n(220)},698:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findConversations=function(){return[].slice.call(document.querySelectorAll(o.CONVERSATION_SELECTOR))};var o=n(136)},707:function(e,t,n){"use strict";var o=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.checkSSO=function(e){if(r.default.get("tenant_config.conversation.ssoSyncCheck",!1)){var t=e.currentUser;try{var n=JSON.parse(localStorage.getItem("SPOTIM_CURRENT_USER")||"")}catch(e){return void i.metrics.error("checkSSO",e)}var o=n&&n.data&&n.data.id;t.id!==o&&window.SPOTIM.startSSO(s)}};var i=n(3),r=o(n(1));function s(e,t){fetch("https://www.thesun.co.uk/api/comments/signin?codeA=".concat(e),{credentials:"include",headers:{accept:"application/json","cache-control":"no-cache",pragma:"no-cache","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},referrerPolicy:"no-referrer-when-downgrade",method:"GET",mode:"cors"}).then((function(e){return e.json()})).then((function(e){return t(e.spotimCodeB)}))}},708:function(e,t,n){"use strict";var o=n(0);Object.defineProperty(t,"__esModule",{value:!0}),t.handleEmailReturn=function(e,t){return c.apply(this,arguments)};var i=o(n(37)),r=o(n(38)),s=o(n(1)),a=n(117);function c(){return(c=(0,r.default)(i.default.mark((function e(t,n){var o,r,c,l,d,u,p,f,m;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.getState(),r=o.moduleOptions,r.spotId){e.next=4;break}return e.abrupt("return");case 4:c=s.default.get("queryParams"),l=c.spot_reset_password,d=c.spot_ticket,u=c.spot_im_verify,p=c.email,m="success"===l&&d,((f="email"===u||"signup"===u)||m)&&(f?(0,a.openRegistrationModal)({mode:"email-verified"}):m&&(0,a.openRegistrationModal)({mode:"set-password",resetPasswordTicket:d,email:p}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=boot-bundle.js.map